<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">RSA</span><span class="hs-operator">.</span><span class="hs-identifier">API</span><span>
</span><a name="line-2"></a><span class="hs-special">(</span><span> </span><a href="RSA.API.html#keygenIO"><span class="hs-identifier hs-var">keygenIO</span></a><span>
</span><a name="line-3"></a><span class="hs-special">,</span><span> </span><a href="RSA.API.html#encryptIO"><span class="hs-identifier hs-var">encryptIO</span></a><span>
</span><a name="line-4"></a><span class="hs-special">,</span><span> </span><a href="RSA.API.html#decryptIO"><span class="hs-identifier hs-var">decryptIO</span></a><span>
</span><a name="line-5"></a><span class="hs-special">,</span><span> </span><a href="RSA.API.html#keygen"><span class="hs-identifier hs-var">keygen</span></a><span>
</span><a name="line-6"></a><span class="hs-special">,</span><span> </span><a href="RSA.API.html#encrypt"><span class="hs-identifier hs-var">encrypt</span></a><span>
</span><a name="line-7"></a><span class="hs-special">,</span><span> </span><a href="RSA.API.html#decrypt"><span class="hs-identifier hs-var">decrypt</span></a><span>
</span><a name="line-8"></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">RandomGen</span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Random</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">R</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">newStdGen</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">append</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pack</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readFile</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unpack</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">writeFile</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="AES.API.html"><span class="hs-identifier">AES</span><span class="hs-operator">.</span><span class="hs-identifier">API</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">AES</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Common.html"><span class="hs-identifier">Common</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="NumberTheory.html"><span class="hs-identifier">NumberTheory</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">NT</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="RSA.Internal.html"><span class="hs-identifier">RSA</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span> </span><span class="hs-special">(</span><a href="RSA.Internal.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="RSA.Internal.html"><span class="hs-identifier">RSA</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Internal</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-comment">-- | Takes an 'Integral' 'size' and two strings 'pubFileOut', 'prvFileOut'.</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- Generates a public/private key pair based on 'keygen' and writes the</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- key pair to the files.</span><span>
</span><a name="line-27"></a><span class="hs-identifier">keygenIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621679041171"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679041171"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><a name="keygenIO"><a href="RSA.API.html#keygenIO"><span class="hs-identifier">keygenIO</span></a></a><span> </span><a name="local-6989586621679041172"><a href="#local-6989586621679041172"><span class="hs-identifier">size</span></a></a><span> </span><a name="local-6989586621679041173"><a href="#local-6989586621679041173"><span class="hs-identifier">pubFileOut</span></a></a><span> </span><a name="local-6989586621679041174"><a href="#local-6989586621679041174"><span class="hs-identifier">prvFileOut</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-29"></a><span>  </span><a name="local-6989586621679041175"><a href="#local-6989586621679041175"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">R</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newStdGen</span><span>
</span><a name="line-30"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679041176"><a href="#local-6989586621679041176"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RSA.API.html#keygen"><span class="hs-identifier hs-var">keygen</span></a><span> </span><a href="#local-6989586621679041175"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679041172"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679041176"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-32"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-string">&quot;wrong file size&quot;</span><span>
</span><a name="line-33"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679041177"><a href="#local-6989586621679041177"><span class="hs-identifier">public</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679041178"><a href="#local-6989586621679041178"><span class="hs-identifier">private</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-34"></a><span>      </span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeFile</span><span> </span><a href="#local-6989586621679041173"><span class="hs-identifier hs-var">pubFileOut</span></a><span> </span><a href="#local-6989586621679041177"><span class="hs-identifier hs-var">public</span></a><span>
</span><a name="line-35"></a><span>      </span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeFile</span><span> </span><a href="#local-6989586621679041174"><span class="hs-identifier hs-var">prvFileOut</span></a><span> </span><a href="#local-6989586621679041178"><span class="hs-identifier hs-var">private</span></a><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-comment">-- | Takes 3 'String's, 'keyFile', 'fileIn', 'fileOut'. 'fileIn' is encrypted</span><span>
</span><a name="line-38"></a><span class="hs-comment">-- based on 'encrypt' with 'keyFile', and the ciphertext is written to</span><span>
</span><a name="line-39"></a><span class="hs-comment">-- 'fileOut'.</span><span>
</span><a name="line-40"></a><span class="hs-identifier">encryptIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><a name="encryptIO"><a href="RSA.API.html#encryptIO"><span class="hs-identifier">encryptIO</span></a></a><span> </span><a name="local-6989586621679041179"><a href="#local-6989586621679041179"><span class="hs-identifier">keyFile</span></a></a><span> </span><a name="local-6989586621679041180"><a href="#local-6989586621679041180"><span class="hs-identifier">fileIn</span></a></a><span> </span><a name="local-6989586621679041181"><a href="#local-6989586621679041181"><span class="hs-identifier">fileOut</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-42"></a><span>  </span><a name="local-6989586621679041182"><a href="#local-6989586621679041182"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readFile</span><span> </span><a href="#local-6989586621679041179"><span class="hs-identifier hs-var">keyFile</span></a><span>
</span><a name="line-43"></a><span>  </span><a name="local-6989586621679041183"><a href="#local-6989586621679041183"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readFile</span><span> </span><a href="#local-6989586621679041180"><span class="hs-identifier hs-var">fileIn</span></a><span>
</span><a name="line-44"></a><span>  </span><a name="local-6989586621679041184"><a href="#local-6989586621679041184"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">R</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">newStdGen</span><span>
</span><a name="line-45"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679041185"><a href="#local-6989586621679041185"><span class="hs-identifier">encrypted</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RSA.API.html#encrypt"><span class="hs-identifier hs-var">encrypt</span></a><span> </span><a href="#local-6989586621679041184"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679041182"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679041183"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeFile</span><span> </span><a href="#local-6989586621679041181"><span class="hs-identifier hs-var">fileOut</span></a><span> </span><a href="#local-6989586621679041185"><span class="hs-identifier hs-var">encrypted</span></a><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | Takes 3 'String's, 'keyFile', 'fileIn', 'fileOut'. 'fileIn' is decrypted</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- based on 'decrypt' with 'keyFile', and the decrypted text is written to</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- 'fileOut'.</span><span>
</span><a name="line-51"></a><span class="hs-identifier">decryptIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><a name="decryptIO"><a href="RSA.API.html#decryptIO"><span class="hs-identifier">decryptIO</span></a></a><span> </span><a name="local-6989586621679041186"><a href="#local-6989586621679041186"><span class="hs-identifier">keyFile</span></a></a><span> </span><a name="local-6989586621679041187"><a href="#local-6989586621679041187"><span class="hs-identifier">fileIn</span></a></a><span> </span><a name="local-6989586621679041188"><a href="#local-6989586621679041188"><span class="hs-identifier">fileOut</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-53"></a><span>  </span><a name="local-6989586621679041189"><a href="#local-6989586621679041189"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readFile</span><span> </span><a href="#local-6989586621679041186"><span class="hs-identifier hs-var">keyFile</span></a><span>
</span><a name="line-54"></a><span>  </span><a name="local-6989586621679041190"><a href="#local-6989586621679041190"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readFile</span><span> </span><a href="#local-6989586621679041187"><span class="hs-identifier hs-var">fileIn</span></a><span>
</span><a name="line-55"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679041191"><a href="#local-6989586621679041191"><span class="hs-identifier">decrypted</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RSA.API.html#decrypt"><span class="hs-identifier hs-var">decrypt</span></a><span> </span><a href="#local-6989586621679041189"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679041190"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-56"></a><span>  </span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeFile</span><span> </span><a href="#local-6989586621679041188"><span class="hs-identifier hs-var">fileOut</span></a><span> </span><a href="#local-6989586621679041191"><span class="hs-identifier hs-var">decrypted</span></a><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-comment">-- | Takes a 'RandomGen' 'g', 'Integral' 'size'. If is 'size' one of 1024,</span><span>
</span><a name="line-59"></a><span class="hs-comment">-- 2048, or 4096 then returns 'Just' ('ByteString', 'ByteString'), where the</span><span>
</span><a name="line-60"></a><span class="hs-comment">-- 'ByteString's are the public and private keys, respectively. If 'size' is</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- anything then 'Nothing' is returned.</span><span>
</span><a name="line-62"></a><span class="hs-identifier">keygen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">RandomGen</span><span> </span><a href="#local-6989586621679041169"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621679041170"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679041169"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679041170"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><a name="keygen"><a href="RSA.API.html#keygen"><span class="hs-identifier">keygen</span></a></a><span> </span><a name="local-6989586621679041192"><a href="#local-6989586621679041192"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679041193"><a href="#local-6989586621679041193"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679041193"><span class="hs-identifier hs-var">size</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-64"></a><span>  </span><a name="local-6989586621679041194"><a href="#local-6989586621679041194"><span class="hs-identifier">s</span></a></a><span> </span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679041194"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-number">1024</span><span class="hs-special">,</span><span> </span><span class="hs-number">2048</span><span class="hs-special">,</span><span> </span><span class="hs-number">4096</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041199"><span class="hs-identifier hs-var">publicKey</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679041200"><span class="hs-identifier hs-var">privateKey</span></a><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679041195"><a href="#local-6989586621679041195"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679041196"><a href="#local-6989586621679041196"><span class="hs-identifier">q</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RSA.Internal.html#genModulus"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">genModulus</span></a><span> </span><a href="#local-6989586621679041192"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679041193"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-68"></a><span>          </span><a name="local-6989586621679041197"><a href="#local-6989586621679041197"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">65537</span><span>
</span><a name="line-69"></a><span>          </span><a name="local-6989586621679041198"><a href="#local-6989586621679041198"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NumberTheory.html#findInverse"><span class="hs-identifier hs-var">NT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">findInverse</span></a><span> </span><a href="#local-6989586621679041197"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679041195"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679041196"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-70"></a><span>          </span><a name="local-6989586621679041199"><a href="#local-6989586621679041199"><span class="hs-identifier">publicKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RSA.Internal.html#keyToByteString"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keyToByteString</span></a><span> </span><a href="RSA.Internal.html#Key"><span class="hs-identifier hs-var">Key</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">keyModulus</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041195"><span class="hs-identifier hs-var">p</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679041196"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">keyExponent</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041197"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">}</span><span>
</span><a name="line-71"></a><span>          </span><a name="local-6989586621679041200"><a href="#local-6989586621679041200"><span class="hs-identifier">privateKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RSA.Internal.html#keyToByteString"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keyToByteString</span></a><span> </span><a href="RSA.Internal.html#Key"><span class="hs-identifier hs-var">Key</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">keyModulus</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041195"><span class="hs-identifier hs-var">p</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621679041196"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">keyExponent</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041198"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">}</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- | Takes a 'RandomGen' g and two 'ByteString's 'k', 'm', representing the</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- 'key' and 'message' to be encrypted. 'm' is encrypted with AES-256</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- in ECB mode (I know) to produce ciphertext 'c'. The generated AES key 'l'</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- is then encrypted with the public key 'k', so the final output is</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- @RSA_k(l)|AES_l(m)@.</span><span>
</span><a name="line-78"></a><span class="hs-identifier">encrypt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">RandomGen</span><span> </span><a href="#local-6989586621679041168"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679041168"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-79"></a><a name="encrypt"><a href="RSA.API.html#encrypt"><span class="hs-identifier">encrypt</span></a></a><span> </span><a name="local-6989586621679041201"><a href="#local-6989586621679041201"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679041202"><a href="#local-6989586621679041202"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679041203"><a href="#local-6989586621679041203"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041209"><span class="hs-identifier hs-var">encryptedAesKey</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679041206"><span class="hs-identifier hs-var">ciphertext</span></a><span>
</span><a name="line-80"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679041204"><a href="#local-6989586621679041204"><span class="hs-identifier">aesKeyBytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="AES.API.html#keygen"><span class="hs-identifier hs-var">AES</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keygen</span></a><span> </span><a href="#local-6989586621679041201"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-number">256</span><span>
</span><a name="line-81"></a><span>        </span><a name="local-6989586621679041205"><a href="#local-6989586621679041205"><span class="hs-identifier">aesKeyInt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Common.html#word8ListToInt"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">word8ListToInt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unpack</span><span> </span><a href="#local-6989586621679041204"><span class="hs-identifier hs-var">aesKeyBytes</span></a><span>
</span><a name="line-82"></a><span>        </span><a name="local-6989586621679041206"><a href="#local-6989586621679041206"><span class="hs-identifier">ciphertext</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="AES.API.html#encrypt"><span class="hs-identifier hs-var">AES</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">encrypt</span></a><span> </span><a href="#local-6989586621679041204"><span class="hs-identifier hs-var">aesKeyBytes</span></a><span> </span><a href="#local-6989586621679041203"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-83"></a><span>        </span><a href="RSA.Internal.html#Key"><span class="hs-identifier hs-var">Key</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">keyModulus</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679041207"><a href="#local-6989586621679041207"><span class="hs-identifier">modulus</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">keyExponent</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679041208"><a href="#local-6989586621679041208"><span class="hs-identifier">e</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RSA.Internal.html#byteStringToKey"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">byteStringToKey</span></a><span> </span><a href="#local-6989586621679041202"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-84"></a><span>        </span><a name="local-6989586621679041209"><a href="#local-6989586621679041209"><span class="hs-identifier">encryptedAesKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Common.html#intToByteString"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">intToByteString</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="NumberTheory.html#powModN"><span class="hs-identifier hs-var">NT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">powModN</span></a><span> </span><a href="#local-6989586621679041205"><span class="hs-identifier hs-var">aesKeyInt</span></a><span> </span><a href="#local-6989586621679041208"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679041207"><span class="hs-identifier hs-var">modulus</span></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-comment">-- | Takes two 'ByteString's 'k', 'm', representing the 'key' and 'ciphertext'</span><span>
</span><a name="line-87"></a><span class="hs-comment">-- to be decrypted.</span><span>
</span><a name="line-88"></a><span class="hs-identifier">decrypt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-89"></a><a name="decrypt"><a href="RSA.API.html#decrypt"><span class="hs-identifier">decrypt</span></a></a><span> </span><a name="local-6989586621679041210"><a href="#local-6989586621679041210"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679041211"><a href="#local-6989586621679041211"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041218"><span class="hs-identifier hs-var">decryptedText</span></a><span>
</span><a name="line-90"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a href="RSA.Internal.html#Key"><span class="hs-identifier hs-var">Key</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">keyModulus</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679041212"><a href="#local-6989586621679041212"><span class="hs-identifier">modulus</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">keyExponent</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679041213"><a href="#local-6989586621679041213"><span class="hs-identifier">d</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RSA.Internal.html#byteStringToKey"><span class="hs-identifier hs-var">Internal</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">byteStringToKey</span></a><span> </span><a href="#local-6989586621679041210"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-91"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679041214"><a href="#local-6989586621679041214"><span class="hs-identifier">encryptedAesKey</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679041215"><a href="#local-6989586621679041215"><span class="hs-identifier">ciphertext</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Common.html#byteStringToInt"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">byteStringToInt</span></a><span> </span><a href="#local-6989586621679041211"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-92"></a><span>        </span><a name="local-6989586621679041216"><a href="#local-6989586621679041216"><span class="hs-identifier">decryptedAesKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NumberTheory.html#powModN"><span class="hs-identifier hs-var">NT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">powModN</span></a><span> </span><a href="#local-6989586621679041214"><span class="hs-identifier hs-var">encryptedAesKey</span></a><span> </span><a href="#local-6989586621679041213"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="#local-6989586621679041212"><span class="hs-identifier hs-var">modulus</span></a><span>
</span><a name="line-93"></a><span>        </span><a name="local-6989586621679041217"><a href="#local-6989586621679041217"><span class="hs-identifier">aesKeyBytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Common.html#intToWord8List"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">intToWord8List</span></a><span> </span><a href="#local-6989586621679041216"><span class="hs-identifier hs-var">decryptedAesKey</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-94"></a><span>        </span><a name="local-6989586621679041218"><a href="#local-6989586621679041218"><span class="hs-identifier">decryptedText</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="AES.API.html#decrypt"><span class="hs-identifier hs-var">AES</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">decrypt</span></a><span> </span><a href="#local-6989586621679041217"><span class="hs-identifier hs-var">aesKeyBytes</span></a><span> </span><a href="#local-6989586621679041215"><span class="hs-identifier hs-var">ciphertext</span></a><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a></pre></body></html>